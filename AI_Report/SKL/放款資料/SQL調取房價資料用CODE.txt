select a.LoanKey,sum(PublicArea) PublicArea into #temp_buildpublic from CL_ImmPublicBuildNo a group by a.LoanKey
-- 房屋使用目的,城市,鄉鎮,主要建材,建物類別,建完日期,擔保品所在樓層 ,鑑價單價坪,附屬建物, 附屬建物面積,房價,押品狀況碼, 貸放成數,押品同額度,有無興建計劃
select a.BuildPurpose,d.PurposeItem ,b.CityItem ,c.AreaItem ,a.BuildMaterial,e.MaterialItem ,g.PublicArea,a.BuildType,
a.BuildComDate ,a.BuildLayer  ,a.AplraiseUnitValue ,f.Item ,a.AdjBuildArea ,h.AplraiseValue ,
h.RecStat,h.DebtPerc ,h.SameAprvSeq ,h.HavePlan 
from CL_ImmBuild a 
left join Paras_Adm_City b on a.CityCode=b.CityCode 
left join Paras_Adm_Area c on a.AreaCode=c.AreaCode and a.CityCode=c.CityCode
left join Paras_Adm_Purpose d on a.BuildPurpose=d.PurposeCode
left join Paras_Adm_Material e on a.BuildMaterial=e.MaterialCode
left join Maintain_Comm_Select f on f.GroupType='Cl_AdjStruc' and f.Code=a.AdjBuildChar
left join #temp_buildpublic g on a.LoanKey=g.LoanKey  
 left join CL_ImmMain h on a.LoanKey=h.LoanKey
 drop table #temp_buildpublic

 select a.LoanKey,sum(PublicArea) PublicArea into #temp_buildpublic from CL_ImmPublicBuildNo a group by a.LoanKey
-- 房屋使用目的,城市,鄉鎮,主要建材,建物類別,建完日期,擔保品所在樓層 ,鑑價單價坪,附屬建物, 附屬建物面積,房價,押品狀況碼, 貸放成數,押品同額度,有無興建計劃
 select a.BuildPurpose+ d.PurposeItem 房屋使用目的,b.CityItem 城市,c.AreaItem 鄉鎮,a.BuildMaterial+e.MaterialItem 主要建材,g.PublicArea,a.BuildType 建議類別,
a.BuildComDate 建完日期,a.BuildLayer 擔保品所在樓層 ,a.AplraiseUnitValue 鑑價單價坪,f.Item 附屬建物,a.AdjBuildArea 附屬建物面積,h.AplraiseValue 房價,
h.RecStat 押品狀況碼,h.DebtPerc 貸放成數,h.SameAprvSeq 押品同額度,h.HavePlan 有無興建計劃
from CL_ImmBuild a 
left join Paras_Adm_City b on a.CityCode=b.CityCode 
left join Paras_Adm_Area c on a.AreaCode=c.AreaCode and a.CityCode=c.CityCode
left join Paras_Adm_Purpose d on a.BuildPurpose=d.PurposeCode
left join Paras_Adm_Material e on a.BuildMaterial=e.MaterialCode
left join Maintain_Comm_Select f on f.GroupType='Cl_AdjStruc' and f.Code=a.AdjBuildChar
left join #temp_buildpublic g on a.LoanKey=g.LoanKey  
 left join CL_ImmMain h on a.LoanKey=h.LoanKey
--select * from #temp_buildpublic
drop table #temp_buildpublic


